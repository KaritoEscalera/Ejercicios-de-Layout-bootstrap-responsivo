<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SoulSpace ‚ú®</title>
  <style>
    :root{
      --bg:#fff9fb;
      --card:#fff;
      --accent1:#ffdce5;
      --accent2:#f7b2c4;
      --accent3:#d17aa2;
      --muted:#6b6b6b;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Poppins", "Trebuchet MS", sans-serif;
      background:var(--bg);
      color:#333;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    header{
      background: linear-gradient(90deg,var(--accent1),#fff1f7);
      padding:18px 12px;
      text-align:center;
      box-shadow:0 6px 18px rgba(13,40,60,0.04);
    }
    header h1{ margin:0; font-family: 'Comfortaa', cursive; color:var(--accent3); letter-spacing:0.6px }
    header p{ margin:6px 0 0; color:var(--muted); font-size:14px }

    /* top area (home) with rotating backgrounds */
    #homeArea{
      min-height:280px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:28px 16px;
      color:#fff;
      position:relative;
      transition:background-image 0.9s ease-in-out;
      background-size:cover;
      background-position:center;
    }
    #homeCard{
      background: rgba(0,0,0,0.35);
      padding:18px;
      border-radius:12px;
      max-width:920px;
    }
    #homeCard p{ font-size:20px; margin:0; font-weight:600 }

    /* stickers */
    .stickers{
      position: absolute;
      top:12px;
      right:12px;
      display:flex;
      gap:10px;
    }
    .sticker{ width:44px; height:44px; opacity:0.95; transform: translateY(0); }

    /* content area */
    .container{
      max-width:1100px;
      margin:18px auto;
      padding:12px;
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:0 8px 28px rgba(20,30,40,0.04);
      margin-bottom:16px;
    }
    .muted{ color:var(--muted) }
    .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
    @media (max-width:820px){ .grid-2{ grid-template-columns:1fr } .stickers{ display:none } }

    /* menu/footer */
    nav.menu{
      position:fixed;
      bottom:10px;
      left:50%;
      transform:translateX(-50%);
      background: linear-gradient(90deg,var(--accent1),#fff1f7);
      padding:8px;
      border-radius:60px;
      box-shadow:0 8px 24px rgba(13,40,60,0.07);
      display:flex;
      gap:8px;
      z-index:999;
    }
    nav.menu button{
      background:transparent;
      border:2px solid transparent;
      padding:10px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:600;
    }
    nav.menu button.active{
      background:linear-gradient(90deg,#fce7f1,#ffeef6);
      border-color: rgba(0,0,0,0.05);
    }

    /* tests & games */
    .test, .game{ margin-top:12px; padding:14px; border-radius:12px; background: linear-gradient(180deg,#fff,#fff7fb); box-shadow:0 6px 18px rgba(0,0,0,0.03) }
    label{ display:block; margin:6px 0 }
    .small{ font-size:13px; color:var(--muted) }

    /* small ui */
    .btn{ background:var(--accent3); color:white; padding:10px 12px; border-radius:10px; border:none; cursor:pointer; font-weight:700 }
    .ghost{ background:transparent; border:1px solid #eee; padding:8px 10px; border-radius:10px; cursor:pointer }
    input[type="text"], input[type="email"], textarea, select{
      width:100%; padding:10px; border-radius:10px; border:1px solid #eee; margin-top:6px;
    }

    /* games specifics */
    #memoriaGrid{ display:grid; grid-template-columns: repeat(4,1fr); gap:10px }
    .memCard{ background:linear-gradient(180deg,#fff,#ffeef6); border-radius:10px; height:70px; display:flex; align-items:center; justify-content:center; font-size:20px; cursor:pointer; user-select:none }
    #bubblesArea{ position:relative; height:320px; background:linear-gradient(180deg,#e6fbff,#fef9ff); border-radius:12px; overflow:hidden }

    /* small responsive fixes */
    @media (max-width:480px){ header h1{ font-size:20px } #homeCard p{ font-size:18px } nav.menu{ gap:6px } nav.menu button{ padding:8px 10px; font-size:13px } }
  </style>
</head>
<body>
  <header>
    <h1>SoulSpace</h1>
    <p>Tu refugio para la mente y el alma ‚Äî m√∫sica, tips, tests y juegos suaves</p>
  </header>

  <!-- HOME with rotating backgrounds and phrases -->
  <section id="homeArea" aria-hidden="false">
    <div id="homeCard">
      <p id="homePhrase">Bienvenida/o a SoulSpace ‚Äî respira, est√°s a salvo.</p>
      <div class="small muted" style="margin-top:8px">Haz clic en las secciones del men√∫ para explorar.</div>
    </div>

    <div class="stickers" aria-hidden="true">
      <!-- stickers (small icons) -->
      <img class="sticker" src="https://i.imgur.com/7bKQK0f.png" alt="taza" title="taza" />
      <img class="sticker" src="https://i.imgur.com/OvMZBs9.png" alt="gatito" title="gatito" />
      <img class="sticker" src="https://i.imgur.com/0YV2QqH.png" alt="libro" title="libro" />
    </div>
  </section>

  <main class="container">

    <!-- INFORMATION -->
    <section id="info" class="card" style="display:none">
      <h2>üå™Ô∏è ¬øQu√© provoca que se deteriore la salud mental?</h2>
      <div class="grid-2">
        <div>
          <ul>
            <li><strong>Estr√©s cr√≥nico:</strong> exceso de responsabilidades y presi√≥n.</li>
            <li><strong>Experiencias traum√°ticas:</strong> bullying, p√©rdidas, violencia.</li>
            <li><strong>Estilos de vida poco saludables:</strong> mal sue√±o, mala alimentaci√≥n.</li>
            <li><strong>Entornos t√≥xicos:</strong> relaciones que invalidan.</li>
            <li><strong>Autoexigencia extrema y aislamiento emocional.</strong></li>
          </ul>
        </div>
        <div>
          <h3>üåà ¬øC√≥mo mejorar tu salud mental?</h3>
          <ol>
            <li>Escucha tus emociones sin juzgarlas.</li>
            <li>Crea espacios seguros (f√≠sicos y digitales).</li>
            <li>Conecta con tu cuerpo: ejercicio suave y descanso.</li>
            <li>Expresa tu mundo interior: escribe, dibuja, canta.</li>
            <li>Busca apoyo emocional o profesional.</li>
            <li>Celebra tus avances, por peque√±os que sean.</li>
          </ol>
        </div>
      </div>

      <div style="margin-top:12px">
        <h3>üß© Trastornos comunes (sin miedo)</h3>
        <table style="width:100%;border-collapse:collapse">
          <thead><tr style="text-align:left"><th>Trastorno</th><th>S√≠ntomas</th><th>Enfoque de cuidado</th></tr></thead>
          <tbody>
            <tr><td>Ansiedad</td><td>Palpitaciones, pensamientos acelerados</td><td>Respiraci√≥n, grounding, terapia</td></tr>
            <tr><td>Depresi√≥n</td><td>Tristeza profunda, apat√≠a</td><td>Rutinas suaves, apoyo, terapia</td></tr>
            <tr><td>Trastorno de p√°nico</td><td>Ataques s√∫bitos</td><td>Grounding, acompa√±amiento</td></tr>
            <tr><td>Trastorno dism√≥rfico</td><td>Obsesi√≥n por la imagen</td><td>Validaci√≥n, terapia</td></tr>
            <tr><td>TEPT</td><td>Flashbacks, hipervigilancia</td><td>Terapia especializada</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- TIPS -->
    <section id="tips" class="card" style="display:none">
      <h2>üå¨Ô∏è Tips: ¬øQu√© hacer en un ataque de ansiedad?</h2>
      <div class="grid-2">
        <div>
          <h4>1. Respiraci√≥n diafragm√°tica o cuadrada</h4>
          <p class="small">Inhala por la nariz dejando que el abdomen suba. Exhala lentamente por la boca. Prueba 4-4-4-4 (inhala 4s, sost√©n 4s, exhala 4s, sost√©n 4s).</p>

          <h4>2. Anclaje visual o t√°ctil</h4>
          <p class="small">Toca un objeto suave o fr√≠o, observa sus detalles (textura, peso, temperatura) para reconectar con el presente.</p>

          <h4>3. Frase de validaci√≥n emocional</h4>
          <p class="small">Repite: ‚ÄúEstoy a salvo. Esto pasar√°. Mi cuerpo est√° aprendiendo a sanar.‚Äù Escr√≠bela en un espejo o calendario visual.</p>

          <h4>4. No huyas del momento</h4>
          <p class="small">Qu√©date y reconoce: nombrar lo que sientes reduce su poder.</p>
        </div>
        <div>
          <h4>üß† Prevenci√≥n y manejo general</h4>
          <ol>
            <li><strong>Relajaci√≥n muscular progresiva:</strong> tensa y relaja de pies a cabeza.</li>
            <li><strong>Diario emocional:</strong> escribe y dibuja tu estado con colores y stickers.</li>
            <li><strong>Rutinas de autocuidado:</strong> sue√±o, alimentaci√≥n, movimiento.</li>
            <li><strong>Terapia o acompa√±amiento profesional:</strong> cuando los s√≠ntomas son persistentes.</li>
          </ol>
          <p class="small">Convierte rutinas en rituales visuales (calendario pastel-tech, stickers, recordatorios suaves).</p>
        </div>
      </div>
    </section>

    <!-- TESTS: single landing that lists all 10 tests (each opens in modal area below) -->
    <section id="tests" class="card" style="display:none">
      <h2>üìù Tests r√°pidos</h2>
      <p class="small">Selecciona un test para responder (10 tests: pensamientos, relaciones, autoestima, ansiedad, depresi√≥n, autocuidado, estr√©s acad√©mico, apego, l√≠mites, identidad)</p>

      <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:12px">
        <button class="btn" onclick="openTest('relacionesTest')">Relaciones t√≥xicas</button>
        <button class="btn" onclick="openTest('pensamientosTest')">Pensamientos intrusivos</button>
        <button class="btn" onclick="openTest('autoestimaTest')">Autoestima</button>
        <button class="btn" onclick="openTest('ansiedadTest')">Ansiedad</button>
        <button class="btn" onclick="openTest('depresionTest')">Depresi√≥n</button>
        <button class="btn" onclick="openTest('autocuidadoTest')">Autocuidado</button>
        <button class="btn" onclick="openTest('estresTest')">Estr√©s acad√©mico</button>
        <button class="btn" onclick="openTest('apegoTest')">Apego emocional</button>
        <button class="btn" onclick="openTest('limitesTest')">L√≠mites personales</button>
        <button class="btn" onclick="openTest('identidadTest')">Identidad y autoconfianza</button>
      </div>

      <div id="testContainer" style="margin-top:18px"></div>
    </section>

    <!-- GAMES landing (opens game pages) -->
    <section id="juegos" class="card" style="display:none">
      <h2>üéÆ Juegos</h2>
      <p class="small">Cada juego abre su pantallita propia y est√° pensado para laptop y celular.</p>

      <div style="display:flex;flex-wrap:wrap;gap:10px;margin-top:12px">
        <button class="btn" onclick="openGame('tetrisGame')">Tetris (simple)</button>
        <button class="btn" onclick="openGame('candyGame')">Candy Match (match-3)</button>
        <button class="btn" onclick="openGame('marioGame')">Mini Mario (plataforma)</button>
        <button class="btn" onclick="openGame('memoriaGame')">Memoria emocional</button>
        <button class="btn" onclick="openGame('triviaGame')">Trivia de emociones</button>
        <button class="btn" onclick="openGame('burbujasGame')">Rompe-burbujas</button>
      </div>

      <div id="gameContainer" style="margin-top:18px"></div>
    </section>

    <!-- M√öSICA -->
    <section id="musica" class="card" style="display:none">
      <h2>üéµ M√∫sica</h2>
      <p class="small">Haz clic en la imagen para abrir la playlist en YouTube</p>
      <a href="https://www.youtube.com/watch?v=Ln4KSN0rchI&list=PLW9UFNLFZzGZY9dGNuAvv-gw7oauYdDtg" target="_blank" rel="noopener">
        <img src="https://i.pinimg.com/1200x/20/cc/aa/20ccaa23c4c2e40047e4a66ff5adaabc.jpg" alt="Playlist" style="width:260px;border-radius:12px;box-shadow:0 8px 28px rgba(13,40,60,0.08)">
      </a>
    </section>

    <!-- COMUNIDAD -->
    <section id="comunidad" class="card" style="display:none">
      <h2>üí¨ Comunidad</h2>
      <p class="small">Comparte pensamientos, reacciona y responde. (Simulado con localStorage para demo)</p>

      <div style="display:flex;gap:8px;align-items:center">
        <input id="comuName" placeholder="Nombre (puedes usar alias)" />
        <input id="comuText" placeholder="Escribe algo amable o un pensamiento..." />
        <button class="btn" onclick="postComu()">Publicar</button>
      </div>
      <div id="comuFeed" style="margin-top:12px"></div>
    </section>

    <!-- LECTURAS -->
    <section id="lecturas" class="card" style="display:none">
      <h2>üìö Lecturas recomendadas</h2>
      <ul>
        <li>‚ÄúEl peligro de estar cuerda‚Äù ‚Äì Rosa Montero</li>
        <li>‚ÄúQuerida yo: tenemos que hablar‚Äù ‚Äì Elizabeth Clap√©s</li>
        <li>‚ÄúLas noches oscuras del alma‚Äù ‚Äì Thomas Moore</li>
        <li>‚ÄúSaludable Mente‚Äù ‚Äì Marian Rojas Estap√©</li>
        <li>‚ÄúC√≥mo dejar de pensar demasiado‚Äù ‚Äì Gwendoline Smith</li>
        <li>‚ÄúEl peque√±o gran libro de la ansiedad‚Äù ‚Äì Ferran Cases</li>
        <li>‚ÄúDespertar el coraz√≥n: El arte de quererse bien‚Äù ‚Äì Sandra Garc√≠a S√°nchez-Beato</li>
        <li>‚ÄúInvicto: logra m√°s, sufre menos‚Äù ‚Äì Marcos V√°zquez</li>
        <li>‚ÄúEl poder del ahora‚Äù ‚Äì Eckhart Tolle</li>
        <li>‚ÄúLos dones de la imperfecci√≥n‚Äù ‚Äì Bren√© Brown</li>
      </ul>
    </section>

    <!-- L√çNEA DE VIDA -->
    <section id="linea" class="card" style="display:none">
      <h2>üìû N√∫meros de L√≠nea de Vida (ejemplos)</h2>
      <p class="small">Si est√°s en crisis, comun√≠cate con servicios de ayuda. Agrega aqu√≠ los n√∫meros locales cuando publiques.</p>
      <ul>
        <li><strong>M√©xico:</strong> L√≠nea de la Vida 800 911 2000</li>
        <li><strong>M√©xico (CDMX):</strong> SAPTEL 800 472 7835</li>
        <li><strong>USA:</strong> 988 (Crisis Hotline)</li>
        <li><strong>Espa√±a:</strong> Tel√©fono de la Esperanza 717 003 717</li>
      </ul>
    </section>

    <!-- ATENCI√ìN GRATIS -->
    <section id="atencion" class="card" style="display:none">
      <h2>üßë‚Äç‚öïÔ∏è Atenci√≥n gratuita</h2>
      <p class="small">Centros comunitarios, cl√≠nicas universitarias y ONGs ofrecen atenci√≥n gratuita en muchos lugares. Busca los recursos locales (salud municipal, universidades, asociaciones civiles).</p>
      <p>Si quieres, puedo ayudarte a buscar servicios locales seg√∫n tu ciudad.</p>
    </section>

  </main>

  <!-- MENU -->
  <nav class="menu" role="navigation" aria-label="Principal">
    <button data-target="homeArea" class="active">Inicio</button>
    <button data-target="info">Informaci√≥n</button>
    <button data-target="tips">Tips</button>
    <button data-target="tests">Tests</button>
    <button data-target="juegos">Juegos</button>
    <button data-target="musica">M√∫sica</button>
    <button data-target="comunidad">Comunidad</button>
    <button data-target="lecturas">Lecturas</button>
    <button data-target="linea">L√≠nea de Vida</button>
    <button data-target="atencion">Atenci√≥n</button>
  </nav>

  <script>
    // DOMContentLoaded so elements exist
    document.addEventListener('DOMContentLoaded', () => {

      /* ----------------- Home rotating phrases + backgrounds ----------------- */
      const phrases = [
        "Respira, est√°s a salvo üå¨Ô∏è",
        "Un paso a la vez, tu ritmo es perfecto üå∏",
        "Eres suficiente tal como eres üíñ",
        "Peque√±os descansos, grandes cambios ‚òï",
        "Hoy mereces ternura y calma üåà"
      ];
      const backgrounds = [
        "https://i.pinimg.com/1200x/73/5e/54/735e542d73f9f76db82c5d84fb124bb6.jpg",
        "https://i.pinimg.com/736x/3b/08/c4/3b08c40c221a909188c8976717c28060.jpg",
        "https://i.pinimg.com/736x/97/12/3d/97123d7002cff7e44768435e76563d22.jpg",
        "https://i.pinimg.com/736x/ed/d9/91/edd991c0f3740fb88b6faed9f335802f.jpg",
        "https://i.pinimg.com/1200x/05/d5/95/05d595c4dffe731e580232e9c1185a3b.jpg"
      ];
      let homeIndex = 0;
      const homeArea = document.getElementById('homeArea');
      const homePhrase = document.getElementById('homePhrase');
      function rotateHome(){
        homePhrase.textContent = phrases[homeIndex];
        homeArea.style.backgroundImage = `url('${backgrounds[homeIndex]}')`;
        homeIndex = (homeIndex + 1) % phrases.length;
      }
      rotateHome();
      setInterval(rotateHome, 5000);

      /* ----------------- Menu navigation ----------------- */
      const menuButtons = document.querySelectorAll('nav.menu button');
      menuButtons.forEach(btn => {
        btn.addEventListener('click', ()=>{
          // active style
          menuButtons.forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          // hide sections and home
          document.querySelectorAll('main .card, main section.card, main section').forEach(s=>{
            if(s.id && s.id !== 'homeArea') s.style.display = 'none';
          });
          // hide homeArea explicit
          document.getElementById('homeArea').style.display = 'none';
          // find target
          const tgt = btn.getAttribute('data-target');
          if(tgt === 'homeArea'){
            document.getElementById('homeArea').style.display = 'flex';
            // show nothing else
            return;
          }
          // show corresponding main section
          const section = document.getElementById(tgt);
          if(section) section.style.display = 'block';
        });
      });

      // default: show home
      document.getElementById('homeArea').style.display = 'flex';

      /* ----------------- Community (localStorage) ----------------- */
      const comuFeed = document.getElementById('comuFeed');
      function loadComu(){
        const arr = JSON.parse(localStorage.getItem('soul_comu')||'[]');
        comuFeed.innerHTML = '';
        arr.slice().reverse().forEach(post=>{
          const div = document.createElement('div');
          div.className = 'card';
          div.style.marginBottom='8px';
          div.innerHTML = `<strong>${escapeHtml(post.name)}</strong><p class="small">${escapeHtml(post.text)}</p>`;
          comuFeed.appendChild(div);
        });
      }
      window.postComu = function(){
        const name = document.getElementById('comuName').value.trim() || 'Anon';
        const text = document.getElementById('comuText').value.trim();
        if(!text) return alert('Escribe algo para publicar.');
        const arr = JSON.parse(localStorage.getItem('soul_comu')||'[]');
        arr.push({name,text,ts:Date.now()});
        localStorage.setItem('soul_comu', JSON.stringify(arr));
        document.getElementById('comuName').value='';
        document.getElementById('comuText').value='';
        loadComu();
      }
      loadComu();

      /* ----------------- Tests engine ----------------- */
      const testsData = {
        relacionesTest: {
          title:'Relaciones t√≥xicas',
          questions:[
            {q:'¬øTe sientes criticado por la otra persona?', opts:['No','A veces','S√≠']},
            {q:'¬øTemes expresar tus emociones por su reacci√≥n?', opts:['No','A veces','S√≠']},
            {q:'¬øHas notado baja en tu autoestima?', opts:['No','A veces','S√≠']}
          ],
          advice(points){
            if(points<=2) return 'üå∏ Consejo: se√±ales leves. Mant√©n l√≠mites y di√°logo.';
            if(points<=4) return '‚ö° Consejo: se√±ales moderadas. Busca apoyo y eval√∫a la relaci√≥n.';
            return 'üö® Consejo: se√±ales fuertes. Busca ayuda profesional y redes de apoyo.';
          }
        },
        pensamientosTest:{
          title:'Pensamientos intrusivos',
          questions:[
            {q:'¬øTienes pensamientos repetitivos que no deseas?', opts:['No','A veces','S√≠']},
            {q:'¬øEsos pensamientos interfieren en tu d√≠a?', opts:['No','A veces','S√≠']},
            {q:'¬øTe generan culpa o verg√ºenza?', opts:['No','A veces','S√≠']}
          ],
          advice(points){
            if(points<=2) return 'üå∏ Consejo: intenta etiquetar el pensamiento y usar t√©cnicas de aceptaci√≥n.';
            if(points<=4) return 'üåº Consejo: pr√°cticas de mindfulness y escribir el pensamiento ayudan.';
            return 'üö® Consejo: si interfieren mucho, busca apoyo profesional.';
          }
        },
        autoestimaTest:{
          title:'Autoestima',
          questions:[
            {q:'¬øTe hablas con amabilidad?', opts:['S√≠','A veces','No']},
            {q:'¬øCelebras tus avances peque√±os?', opts:['S√≠','A veces','No']},
            {q:'¬øTe comparas frecuentemente con otros?', opts:['No','A veces','S√≠']}
          ],
          advice(points){
            if(points>=5) return 'üå∏ Consejo: buena relaci√≥n contigo. Mant√©n rituales de autocuidado.';
            if(points>=3) return 'üåº Consejo: trabaja afirmaciones y reconoce logros.';
            return '‚ö° Consejo: prueba ejercicios de autocompasi√≥n y apoyo profesional si lo necesitas.';
          }
        },
        ansiedadTest:{
          title:'Ansiedad',
          questions:[
            {q:'¬øSientes inquietud o tensi√≥n frecuente?', opts:['No','A veces','S√≠']},
            {q:'¬øTienes pensamientos acelerados?', opts:['No','A veces','S√≠']},
            {q:'¬øTienes problemas de sue√±o por preocupaciones?', opts:['No','A veces','S√≠']}
          ],
          advice(points){
            if(points<=2) return 'üå∏ Consejo: t√©cnicas de respiraci√≥n y pausas diarias pueden ayudar.';
            if(points<=4) return 'üåº Consejo: regula sue√±o y practica grounding.';
            return 'üö® Consejo: si los s√≠ntomas son intensos, consulta a un profesional.';
          }
        },
        depresionTest:{
          title:'Depresi√≥n',
          questions:[
            {q:'¬øSientes tristeza persistente?', opts:['No','A veces','S√≠']},
            {q:'¬øHas perdido inter√©s en actividades?', opts:['No','A veces','S√≠']},
            {q:'¬øCambia tu apetito o sue√±o notoriamente?', opts:['No','A veces','S√≠']}
          ],
          advice(points){
            if(points<=2) return 'üå∏ Consejo: mant√©n rutinas y busca apoyo.';
            if(points<=4) return 'üåº Consejo: comparte con alguien de confianza y cuida el sue√±o.';
            return 'üö® Consejo: busca evaluaci√≥n profesional; hay tratamientos efectivos.';
          }
        },
        autocuidadoTest:{
          title:'Autocuidado',
          questions:[
            {q:'¬øDedic√°s tiempo a descansar?', opts:['S√≠','A veces','No']},
            {q:'¬øCom√©s equilibrado y te mov√©s?', opts:['S√≠','A veces','No']},
            {q:'¬øReserv√°s momentos creativos para ti?', opts:['S√≠','A veces','No']}
          ],
          advice(points){
            if(points>=5) return 'üå∏ Consejo: excelente, sigue con esos rituales.';
            if(points>=3) return 'üåº Consejo: organiza peque√±as rutinas diarias.';
            return '‚ö° Consejo: planifica mini-rituales (5-15min) para empezar.';
          }
        },
        estresTest:{
          title:'Estr√©s acad√©mico',
          questions:[
            {q:'¬øTe sientes abrumado por tareas?', opts:['No','A veces','S√≠']},
            {q:'¬øTe cuesta concentrarte por la carga?', opts:['No','A veces','S√≠']},
            {q:'¬øDuermes menos por estudiar?', opts:['No','A veces','S√≠']}
          ],
          advice(points){
            if(points<=2) return 'üå∏ Consejo: organiza tiempos y descansos micro.';
            if(points<=4) return 'üåº Consejo: busca apoyo acad√©mico o tutor√≠as.';
            return 'üö® Consejo: habla con orientaci√≥n escolar o profesional.';
          }
        },
        apegoTest:{
          title:'Apego emocional',
          questions:[
            {q:'¬øTe angustia estar sin la otra persona?', opts:['No','A veces','S√≠']},
            {q:'¬øBuscas constante reaseguro emocional?', opts:['No','A veces','S√≠']},
            {q:'¬øTe cuesta soltar relaciones que lastiman?', opts:['No','A veces','S√≠']}
          ],
          advice(points){
            if(points<=2) return 'üå∏ Consejo: practica independencia gradual y autocuidado.';
            if(points<=4) return 'üåº Consejo: reflexiona sobre l√≠mites y apoyo.';
            return 'üö® Consejo: considera terapia para trabajar patrones de apego.';
          }
        },
        limitesTest:{
          title:'L√≠mites personales',
          questions:[
            {q:'¬øTe cuesta decir ‚Äúno‚Äù?', opts:['No','A veces','S√≠']},
            {q:'¬øTe sientes resentido por aceptar mucho?', opts:['No','A veces','S√≠']},
            {q:'¬øTe priorizas en decisiones importantes?', opts:['S√≠','A veces','No']}
          ],
          advice(points){
            if(points<=2) return 'üå∏ Consejo: sigue practicando asertividad.';
            if(points<=4) return 'üåº Consejo: ejercicios de ‚Äúponer l√≠mites‚Äù en peque√±os pasos.';
            return '‚ö° Consejo: trabaja con ejemplos concretos y role-play apoyado.';
          }
        },
        identidadTest:{
          title:'Identidad y Autoconfianza',
          questions:[
            {q:'¬øTe sientes a gusto expres√°ndote?', opts:['S√≠','A veces','No']},
            {q:'¬øTomas decisiones alineadas con tus valores?', opts:['S√≠','A veces','No']},
            {q:'¬øBuscas validaci√≥n externa frecuentemente?', opts:['No','A veces','S√≠']}
          ],
          advice(points){
            if(points>=5) return 'üå∏ Consejo: confianza s√≥lida; sigue celebrando tu autenticidad.';
            if(points>=3) return 'üåº Consejo: trabaja valores y pr√°cticas de autoafirmaci√≥n.';
            return '‚ö° Consejo: ejercicios de reflexi√≥n y acompa√±amiento pueden ayudar.';
          }
        }
      };

      // open test UI into testContainer
      window.openTest = function(testKey){
        const tc = document.getElementById('testContainer');
        const data = testsData[testKey];
        if(!data) return;
        tc.innerHTML = '';
        const wrapper = document.createElement('div');
        wrapper.className = 'card';
        const t = document.createElement('h3'); t.innerText = data.title;
        wrapper.appendChild(t);

        // create questions
        data.questions.forEach((qq, idx)=>{
          const div = document.createElement('div');
          div.className = 'pregunta';
          const p = document.createElement('p'); p.innerText = (idx+1)+'. '+qq.q;
          div.appendChild(p);
          // options as radio (value 0..2 where greater => more concern)
          qq.opts.forEach((opt,i)=>{
            const label = document.createElement('label');
            label.innerHTML = `<input type="radio" name="q_${testKey}_${idx}" value="${i}"> ${opt}`;
            div.appendChild(label);
          });
          wrapper.appendChild(div);
        });
        const btn = document.createElement('button'); btn.className='btn'; btn.innerText='Ver resultado';
        btn.onclick = ()=>{
          // gather score: convert option index to point: 0->0,1->1,2->2 (simple)
          let points = 0;
          const totalQuestions = data.questions.length;
          for(let i=0;i<totalQuestions;i++){
            const sel = wrapper.querySelector(`input[name="q_${testKey}_${i}"]:checked`);
            if(sel) points += Number(sel.value);
          }
          // map points to advice
          const advice = data.advice(points);
          resultDiv.innerText = advice;
        };
        wrapper.appendChild(btn);
        const resultDiv = document.createElement('div'); resultDiv.className='resultado';
        resultDiv.style.marginTop='12px';
        wrapper.appendChild(resultDiv);
        tc.appendChild(wrapper);
        // scroll
        tc.scrollIntoView({behavior:'smooth'});
      };

      /* ----------------- Games area ----------------- */
      function clearGameContainer(){
        const g = document.getElementById('gameContainer');
        g.innerHTML = '';
      }
      window.openGame = function(key){
        const g = document.getElementById('gameContainer');
        g.innerHTML = '';
        if(key==='tetrisGame') initTetris(g);
        if(key==='candyGame') initCandyMatch(g);
        if(key==='marioGame') initMiniMario(g);
        if(key==='memoriaGame') initMemoriaGame(g);
        if(key==='triviaGame') initTriviaGame(g);
        if(key==='burbujasGame') initBurbujasGame(g);
        g.scrollIntoView({behavior:'smooth'});
      };

      /* ---------- TETRIS (very simple visual) ---------- */
      function initTetris(parent){
        clearGameContainer();
        const wrapper = document.createElement('div'); wrapper.className='card';
        wrapper.innerHTML = `<h3>Tetris Pastel (demo)</h3>
          <canvas id="tetrisCanvas" width="200" height="360" style="display:block;margin:auto;background:#fff;border-radius:8px"></canvas>
          <p class="small">Controles: flechas izquierda/derecha para mover, flecha abajo para acelerar. (Demo simple)</p>`;
        parent.appendChild(wrapper);
        const canvas = wrapper.querySelector('#tetrisCanvas');
        const ctx = canvas.getContext('2d');
        const cols = 10, rows = 18, scale = 20;
        canvas.width = cols*scale; canvas.height = rows*scale;
        const board = Array.from({length:rows},()=>Array(cols).fill(0));
        // simple falling square demo
        let piece = {x:4,y:0,w:2,h:2, color:'#ffdce5'};
        function draw(){
          ctx.clearRect(0,0,canvas.width,canvas.height);
          // board
          for(let r=0;r<rows;r++) for(let c=0;c<cols;c++){
            if(board[r][c]){ ctx.fillStyle = board[r][c]; ctx.fillRect(c*scale,r*scale,scale-1,scale-1); }
          }
          // piece
          ctx.fillStyle = piece.color;
          for(let ry=0;ry<piece.h;ry++) for(let rx=0;rx<piece.w;rx++){
            ctx.fillRect((piece.x+rx)*scale,(piece.y+ry)*scale,scale-1,scale-1);
          }
        }
        function step(){
          piece.y++;
          if(piece.y+piece.h>rows){
            // fix in board
            for(let ry=0;ry<piece.h;ry++) for(let rx=0;rx<piece.w;rx++){
              const r = piece.y+ry-1, c = piece.x+rx;
              if(r>=0 && c>=0 && c<cols) board[r][c]=piece.color;
            }
            piece = {x:4,y:0,w:2,h:2, color:['#ffdce5','#f7b2c4','#d17aa2','#cdeffb'][Math.floor(Math.random()*4)]};
          }
          draw();
        }
        draw();
        const interval = setInterval(step,700);
        // simple controls
        window.addEventListener('keydown', tetrisKey);
        function tetrisKey(e){
          if(e.key==='ArrowLeft'){ piece.x = Math.max(0,piece.x-1); draw(); }
          if(e.key==='ArrowRight'){ piece.x = Math.min(cols-piece.w,piece.x+1); draw(); }
          if(e.key==='ArrowDown'){ piece.y = Math.min(rows-piece.h,piece.y+1); draw(); }
        }
        // cleanup when switching games: remove event listener and interval
        parent.dataset.cleanup = () => { clearInterval(interval); window.removeEventListener('keydown', tetrisKey); };
      }

      /* ---------- Candy Match (simple grid random colors) ---------- */
      function initCandyMatch(parent){
        clearGameContainer();
        const wrapper = document.createElement('div'); wrapper.className='card';
        wrapper.innerHTML = `<h3>Candy Match (demo)</h3>
          <div id="candyGrid" style="display:grid;grid-template-columns:repeat(6,48px);gap:6px;justify-content:center"></div>
          <p class="small">Haz coincidir 3 o m√°s colores (demo simple). Toca dos celdas para intercambiar.</p>`;
        parent.appendChild(wrapper);
        const grid = wrapper.querySelector('#candyGrid');
        const size = 6;
        const colors = ['#ffdce5','#f7b2c4','#d17aa2','#cdeffb','#ffe8a8'];
        let board = [];
        function fillBoard(){
          grid.innerHTML='';
          board = [];
          for(let i=0;i<size*size;i++){
            const col = colors[Math.floor(Math.random()*colors.length)];
            board.push(col);
            const cell = document.createElement('div');
            cell.style.width='48px'; cell.style.height='48px'; cell.style.borderRadius='10px';
            cell.style.background=col; cell.style.cursor='pointer';
            cell.dataset.i = i;
            grid.appendChild(cell);
          }
        }
        let sel = null;
        grid.addEventListener('click', (e)=>{
          if(!e.target.dataset.i) return;
          const i = Number(e.target.dataset.i);
          if(sel===null){ sel=i; e.target.style.outline='3px solid rgba(0,0,0,0.08)'; }
          else {
            // swap
            const elPrev = grid.querySelector(`[data-i="${sel}"]`);
            const temp = board[sel]; board[sel]=board[i]; board[i]=temp;
            // refresh visuals
            grid.querySelectorAll('div').forEach(d=> d.style.background = board[Number(d.dataset.i)]);
            if(elPrev) elPrev.style.outline='';
            sel = null;
            // NOTE: For demo we won't implement full match-check gravity, keep simple.
          }
        });
        fillBoard();
      }

      /* ---------- Mini Mario (very simple platformer demo) ---------- */
      function initMiniMario(parent){
        clearGameContainer();
        const wrapper = document.createElement('div'); wrapper.className='card';
        wrapper.innerHTML = `<h3>Mini Mario (demo)</h3>
          <canvas id="marioCanvas" width="360" height="160" style="display:block;margin:auto;border-radius:8px;background:linear-gradient(#cdeffb,#fef9ff)"></canvas>
          <p class="small">Controles: bot√≥n de salto (arriba) - demo visual</p>`;
        parent.appendChild(wrapper);
        const canvas = wrapper.querySelector('#marioCanvas');
        const ctx = canvas.getContext('2d');
        let playerY = 110, vy=0, gravity=0.9;
        function draw(){
          ctx.clearRect(0,0,canvas.width,canvas.height);
          // ground
          ctx.fillStyle='#6bbf6b'; ctx.fillRect(0,140,canvas.width,20);
          // player
          ctx.fillStyle='#d17aa2';
          ctx.fillRect(40, playerY-20, 18, 20);
          // simple obstacle
          ctx.fillStyle='#444'; ctx.fillRect(220,120,18,20);
        }
        function step(){
          vy += gravity; playerY += vy;
          if(playerY>110){ playerY=110; vy=0; }
          draw();
        }
        draw();
        const t = setInterval(step,30);
        // simple jump button
        const jumpBtn = document.createElement('button'); jumpBtn.className='btn'; jumpBtn.style.marginTop='8px'; jumpBtn.innerText='Saltar ‚¨Ü';
        jumpBtn.onclick=()=>{ if(playerY>=110) { vy = -8; } };
        wrapper.appendChild(jumpBtn);
        parent.dataset.cleanup = () => { clearInterval(t); };
      }

      /* ---------- Memoria Emocional (memorama) ---------- */
      function initMemoriaGame(parent){
        clearGameContainer();
        const wrapper = document.createElement('div'); wrapper.className='card';
        wrapper.innerHTML = `<h3>Memoria Emocional</h3>
          <div id="memoriaGrid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;justify-items:center"></div>
          <p class="small">Encuentra las parejas de frases afirmativas üíñ</p>`;
        parent.appendChild(wrapper);
        const grid = wrapper.querySelector('#memoriaGrid');
        const pairs = ["Merezco amor","Soy valiosa/o","Merezco amor","Soy valiosa/o","Estoy aprendiendo","Me doy permiso","Estoy aprendiendo","Me doy permiso"];
        let deck = pairs.sort(()=>0.5-Math.random());
        let open = [];
        let matched = Array(deck.length).fill(false);
        function render(){
          grid.innerHTML='';
          deck.forEach((val,i)=>{
            const card = document.createElement('div');
            card.className = 'memCard';
            card.dataset.i = i;
            card.innerText = matched[i] ? val : (open.includes(i) ? val : '‚ùì');
            card.onclick = () => {
              if(open.includes(i) || matched[i]) return;
              open.push(i);
              render();
              if(open.length===2){
                const [a,b] = open;
                if(deck[a]===deck[b]){ matched[a]=matched[b]=true; open=[]; }
                else { setTimeout(()=>{ open=[]; render(); },700); }
              }
            };
            grid.appendChild(card);
          });
        }
        render();
      }

      /* ---------- Trivia Game (short) ---------- */
      function initTriviaGame(parent){
        clearGameContainer();
        const wrapper = document.createElement('div'); wrapper.className='card';
        wrapper.innerHTML = `<h3>Trivia de Emociones</h3><div id="triviaArea"></div>`;
        parent.appendChild(wrapper);
        const area = wrapper.querySelector('#triviaArea');
        const questions = [
          {q:'¬øQu√© t√©cnica ayuda en un ataque de ansiedad?', a:'Respiraci√≥n diafragm√°tica'},
          {q:'¬øQu√© reduce el poder de un pensamiento intrusivo?', a:'Nombrarlo y observarlo'},
          {q:'¬øQu√© es autocuidado?', a:'Rutinas para tu bienestar'}
        ];
        let idx = 0;
        function showQ(){
          if(idx>=questions.length){ area.innerHTML = `<div class="resultado">¬°Bien! Terminaste la trivia üéâ</div>`; return; }
          const Q = questions[idx];
          area.innerHTML = `<div class="pregunta"><p><strong>${Q.q}</strong></p>
            <input id="ansInput" placeholder="Escribe tu respuesta corta" />
            <button class="btn" id="checkBtn">Comprobar</button></div>`;
          area.querySelector('#checkBtn').onclick = ()=>{
            const val = area.querySelector('#ansInput').value.trim().toLowerCase();
            if(!val) return alert('Escribe algo :)');
            if(val.includes(Q.a.split(' ')[0].toLowerCase())){ alert('¬°Correcto! üíñ'); }
            else alert('Respuesta orientativa: '+Q.a);
            idx++; showQ();
          };
        }
        showQ();
      }

      /* ---------- Burbujas anti-estr√©s ---------- */
      function initBurbujasGame(parent){
        clearGameContainer();
        const wrapper = document.createElement('div'); wrapper.className='card';
        wrapper.innerHTML = `<h3>Rompe-burbujas de estr√©s</h3><div id="bubblesArea" style="height:320px;border-radius:12px;overflow:hidden;position:relative"></div>
          <div style="margin-top:8px"><span class="small">Haz clic o toca las burbujas para hacerlas desaparecer.</span></div>`;
        parent.appendChild(wrapper);
        const area = wrapper.querySelector('#bubblesArea');
        function spawn(){
          const b = document.createElement('div');
          const size = (Math.random()*60)+30;
          b.style.width = b.style.height = size+'px';
          b.style.borderRadius = '50%';
          b.style.position = 'absolute';
          b.style.left = Math.random()*(area.clientWidth - size)+'px';
          b.style.top = Math.random()*(area.clientHeight - size)+'px';
          b.style.background = ['rgba(255,220,229,0.9)','rgba(204,238,255,0.9)','rgba(255,241,204,0.95)'][Math.floor(Math.random()*3)];
          b.style.display='flex'; b.style.alignItems='center'; b.style.justifyContent='center';
          b.style.fontSize = '18px'; b.style.cursor='pointer';
          b.innerText = 'üí≠';
          area.appendChild(b);
          b.onclick = ()=>{ b.remove(); };
          setTimeout(()=>{ if(b.parentElement) b.remove(); },7000);
        }
        // spawn bunch
        const spawns = setInterval(spawn,350);
        // stop on leaving game (store cleanup)
        parent.dataset.cleanup = () => { clearInterval(spawns); };
      }

      /* ----------------- Utility functions ----------------- */
      function escapeHtml(unsafe){ return unsafe.replace(/[&<"'>]/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]; }); }

      /* ----------------- Initialize: show small defaults ----------------- */
      // by default show home; menu already shows home.
      // Pre-init small bits (nothing else)
      // Nothing else to do here
    }); // DOMContentLoaded end
  </script>
</body>
</html>
